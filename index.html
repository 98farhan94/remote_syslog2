<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="remote_syslog2 : Lightweight self-contained daemon for reading local files and emitting remote syslog (without using local syslog daemon)">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>remote_syslog2</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/papertrail/remote_syslog2">View on GitHub</a>

          <h1 id="project_title">remote_syslog2</h1>
          <h2 id="project_tagline">Lightweight self-contained daemon for reading local files and emitting remote syslog (without using local syslog daemon)</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/papertrail/remote_syslog2/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/papertrail/remote_syslog2/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="remote_syslog2" class="anchor" href="#remote_syslog2"><span class="octicon octicon-link"></span></a>remote_syslog2</h1>

<p>Remote_syslog tails one or more log files and sends syslog messages to a
remote central syslog server. It generates packets itself, ignoring the system
syslog daemon, so its configuration doesn't affect system-wide logging.</p>

<p>Uses:</p>

<ul>
<li>Collecting logs from servers &amp; daemons which don't natively support syslog</li>
<li>When reconfiguring the system logger is less convenient than a
purpose-built daemon (e.g., automated app deployments)</li>
<li>Aggregating files not generated by daemons (e.g., package manager logs)</li>
</ul><p>This code is tested with the hosted log management service <a href="http://papertrailapp.com/">Papertrail</a>
and should work for transmitting to any syslog server.</p>

<h2>
<a name="download" class="anchor" href="#download"><span class="octicon octicon-link"></span></a>Download</h2>

<p>Visit <a href="https://github.com/papertrail/remote_syslog2/releases">Releases</a>.</p>

<h2>
<a name="migrating-from-remote_syslog-1" class="anchor" href="#migrating-from-remote_syslog-1"><span class="octicon octicon-link"></span></a>Migrating from remote_syslog 1</h2>

<p>remote_syslog2 is a rewrite of the ruby <a href="https://github.com/papertrail/remote_syslog">remote_syslog</a> package. Not all
features of the ruby version are supported, and there are some backwards
incompatible changes.</p>

<h3>
<a name="which-should-i-use" class="anchor" href="#which-should-i-use"><span class="octicon octicon-link"></span></a>Which should I use?</h3>

<p>Use remote_syslog2 (this README and application) unless you have a
specific reason to use remote_syslog1.</p>

<h3>
<a name="changes-from-remote_syslog-1" class="anchor" href="#changes-from-remote_syslog-1"><span class="octicon octicon-link"></span></a>Changes from remote_syslog 1</h3>

<ul>
<li>The syntax of some command-line arguments have changed slightly,
though most are identical.</li>
<li>Default hostname has been removed. Either the <code>host</code> config file
option or the <code>-d</code> invocation flag are required.</li>
</ul><h2>
<a name="installing" class="anchor" href="#installing"><span class="octicon octicon-link"></span></a>Installing</h2>

<p>Precompiled binaries for Mac, Linux and Windows are available on the
<a href="https://github.com/papertrail/remote_syslog2/releases">remote_syslog2 releases page</a>.</p>

<p>Untar the package, copy the "remote_syslog" executable into your $PATH,
and then customize the included example_config.yml with the log file paths
to read and the host/port to log to.</p>

<p>Optionally, move and rename the configuration file to <code>/etc/log_files.yml</code> so
that remote_syslog picks it up automatically. For example:</p>

<pre><code>sudo cp ./remote_syslog /usr/local/bin
sudo cp example_config.yml /etc/log_files.yml
sudo vi /etc/log_files.yml
</code></pre>

<p>Configuration directives can also be specified as command-line arguments (below).</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<pre><code>Usage of remote_syslog2:
  -c, --configfile="/etc/log_files.yml": Path to config
      --debug-log-cfg="": the debug log file
  -d, --dest-host="": Destination syslog hostname or IP
  -p, --dest-port=514: Destination syslog port
      --eventmachine-tail=false: No action, provided for backwards compatibility
  -f, --facility="user": Facility
      --hostname="": Local hostname to send from
      --log="&lt;root&gt;=INFO": "logging configuration &lt;root&gt;=INFO;first=TRACE"
      --new-file-check-interval={0}: How often to check for new files
  -D, --no-detach=false: Don't daemonize and detach from the terminal
      --no-eventmachine-tail=false: No action, provided for backwards compatibility
      --pid-file="": Location of the PID file
  -s, --severity="notice": Severity
      --tcp=false: Connect via TCP (no TLS)
      --tls=false: Connect via TCP with TLS
</code></pre>

<h2>
<a name="example" class="anchor" href="#example"><span class="octicon octicon-link"></span></a>Example</h2>

<p>Daemonize and collect messages from files listed in <code>./example_config.yml</code> as
well as the file <code>/var/log/mysqld.log</code>. Write PID to <code>/tmp/remote_syslog.pid</code>
and send to port <code>logs.papertrailapp.com:12345</code>:</p>

<pre><code>$ remote_syslog -c example_config.yml -p 12345 --pid-file=/tmp/remote_syslog.pid /var/log/mysqld.log
</code></pre>

<p>Stay attached to the terminal, look for and use <code>/etc/log_files.yml</code> if it
exists, and send with facility local0 to <code>a.example.com:514</code>:</p>

<pre><code>$ remote_syslog -D -d a.example.com -f local0 /var/log/mysqld.log
</code></pre>

<h2>
<a name="auto-starting-at-boot" class="anchor" href="#auto-starting-at-boot"><span class="octicon octicon-link"></span></a>Auto-starting at boot</h2>

<p>Sample init files can be found <a href="https://github.com/papertrail/remote_syslog2/blob/master/examples/">here</a>. You may be able to:</p>

<pre><code>$ cp examples/remote_syslog.init.d /etc/init.d/remote_syslog
$ chmod 755 /etc/init.d/remote_syslog
</code></pre>

<p>And then ensure it's started at boot, either by using:</p>

<pre><code>$ sudo update-rc.d remote_syslog defaults
</code></pre>

<p>or by creating a link manually:</p>

<pre><code>$ sudo ln -s /etc/init.d/remote_syslog /etc/rc3.d/S30remote_syslog
</code></pre>

<p>remote_syslog will daemonize by default.</p>

<p>Init files: <a href="https://github.com/papertrail/remote_syslog2/blob/master/examples/remote_syslog.init.d">remote_syslog.init.d</a> (init.d), OS X <a href="https://github.com/papertrail/remote_syslog2/blob/master/examples/com.papertrailapp.remote_syslog.plist">launchd</a>, <a href="https://github.com/papertrail/remote_syslog2/blob/master/examples/remote_syslog.supervisor.conf">supervisor</a>, Ubuntu <a href="https://github.com/papertrail/remote_syslog2/blob/master/examples/remote_syslog.upstart.conf">upstart</a></p>

<h2>
<a name="sending-messages-securely" class="anchor" href="#sending-messages-securely"><span class="octicon octicon-link"></span></a>Sending messages securely</h2>

<p>If the receiving system supports sending syslog over TCP with TLS, you can
pass the <code>--tls</code> option when running <code>remote_syslog</code>:</p>

<pre><code>$ remote_syslog -D --tls -p 1234 /var/log/mysqld.log
</code></pre>

<p>or add <code>protocol: tls</code> to your configuration file.</p>

<h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>By default, remote_syslog looks for a configuration in <code>/etc/log_files.yml</code>.</p>

<p>The archive comes with a <a href="https://github.com/papertrail/remote_syslog2/blob/master/example_config.yml">sample config</a>. Optionally:</p>

<pre><code>$ cp example_config.yml.example /etc/log_files.yml
</code></pre>

<p><code>log_files.yml</code> has filenames to log from (as an array) and hostname and port
to log to (as a hash). Wildcards are supported using * and standard shell
globbing. Filenames given on the command line are additive to those in
the config file.</p>

<p>Only 1 destination server is supported; the command-line argument wins.</p>

<pre><code>files:
 - /var/log/httpd/access_log
 - /var/log/httpd/error_log
 - /var/log/mysqld.log
 - /var/run/mysqld/mysqld-slow.log
destination:
  host: logs.papertrailapp.com
  port: 12345
  protocol: tls
</code></pre>

<p>remote_syslog sends the name of the file without a path ("mysqld.log") as
the syslog tag (program name).</p>

<p>After changing the configuration file, restart <code>remote_syslog</code> using the
init script or by manually killing and restarting the process. For example:</p>

<pre><code>/etc/init.d/remote_syslog restart
</code></pre>

<h2>
<a name="advanced-configuration-optional" class="anchor" href="#advanced-configuration-optional"><span class="octicon octicon-link"></span></a>Advanced Configuration (Optional)</h2>

<p>Here's an <a href="https://github.com/papertrail/remote_syslog2/blob/master/examples/log_files.yml.example.advanced">advanced config</a> which uses all options.</p>

<h3>
<a name="override-hostname" class="anchor" href="#override-hostname"><span class="octicon octicon-link"></span></a>Override hostname</h3>

<p>Provide <code>--hostname somehostname</code> or use the <code>hostname</code> configuration option:</p>

<pre><code>hostname: somehostname
</code></pre>

<h3>
<a name="detecting-new-files" class="anchor" href="#detecting-new-files"><span class="octicon octicon-link"></span></a>Detecting new files</h3>

<p>remote_syslog automatically detects and activates new log files that match
its file specifiers. For example, <code>*.log</code> may be provided as a file specifier,
and remote_syslog will detect a <code>some.log</code> file created after it was started.
Globs are re-checked every 10 seconds.</p>

<p>Note: messages may be written to files in the 0-10 seconds between when the
file is created and when the periodic glob check detects it. This data is not
acted on.</p>

<p>If globs are specified on the command-line, enclose each one in single-quotes
(<code>'*.log'</code>) so the shell passes the raw glob string to remote_syslog (rather
than the current set of matches). This is not necessary for globs defined in
the config file.</p>

<h3>
<a name="log-rotation" class="anchor" href="#log-rotation"><span class="octicon octicon-link"></span></a>Log rotation</h3>

<p>External log rotation scripts often move or remove an existing log file
and replace it with a new one (at a new inode). The Linux standard script
<a href="http://iain.cx/src/logrotate/">logrotate</a> supports a <code>copytruncate</code> config
option.  With that option, <code>logrotate</code> will copy files, operate on the copies,
and truncate the original so that the inode remains the same.</p>

<p>This comes closest to ensuring that programs watching these files (including
<code>remote_syslog</code>) will not be affected by, or need to be notified of, the
rotation. The only tradeoff of <code>copytruncate</code> is slightly higher disk usage
during rotation, so we recommend this option whether or not you use
<code>remote_syslog</code>.</p>

<h3>
<a name="excluding-files-from-being-sent" class="anchor" href="#excluding-files-from-being-sent"><span class="octicon octicon-link"></span></a>Excluding files from being sent</h3>

<p>Provide one or more regular expressions to prevent certain files from being
matched.</p>

<pre><code>exclude_files:
  - \.\d$
  - .bz2
  - .gz
</code></pre>

<h3>
<a name="excluding-lines-matching-a-pattern" class="anchor" href="#excluding-lines-matching-a-pattern"><span class="octicon octicon-link"></span></a>Excluding lines matching a pattern</h3>

<p>There may be certain log messages that you do not want to be sent.  These may be
repetitive log lines that are "noise" that you might not be able to filter out
easily from the respective application.  To filter these lines, use the
exclude_patterns with an array or regexes:</p>

<pre><code>exclude_patterns:
 - exclude this
 - \d+ things
</code></pre>

<h3>
<a name="multiple-instances" class="anchor" href="#multiple-instances"><span class="octicon octicon-link"></span></a>Multiple instances</h3>

<p>Run multiple instances to specify unique syslog hostnames.</p>

<p>To do that, provide an alternate PID path as a command-line option to the
additional instance(s). For example:</p>

<pre><code>--pid-file=/var/run/remote_syslog_2.pid
</code></pre>

<p>Note: Daemonized programs use PID files to identify whether the program is already
running (<a href="http://unix.stackexchange.com/questions/12815/what-are-pid-and-lock-files-for/12818#12818">more</a>). Like other daemons, remote_syslog will refuse to run as a
daemon (the default mode) when a PID file is present. If a .pid file is
present but the daemon is not actually running, remove the PID file.</p>

<h3>
<a name="choosing-app-name" class="anchor" href="#choosing-app-name"><span class="octicon octicon-link"></span></a>Choosing app name</h3>

<p>remote_syslog uses the log file name (like "access_log") as the syslog
program name, or what the syslog RFCs call the "tag." This is ideal unless
remote_syslog watches many files that have the same name.</p>

<p>In that case, tell remote_syslog to set another program name by creating
symbolic link to the generically-named file:</p>

<pre><code>cd /path/to/logs
ln -s generic_name.log unique_name.log
</code></pre>

<p>Point remote_syslog at unique_name.log. It will use that as the program name.</p>

<h2>
<a name="troubleshooting" class="anchor" href="#troubleshooting"><span class="octicon octicon-link"></span></a>Troubleshooting</h2>

<p>When running remote_syslog in the foreground using the <code>-D</code> switch, if you
receive the error:</p>

<pre><code>Error creating fsnotify watcher: inotify_init: too many open files
</code></pre>

<p>determine the maximum number of inotify instances that can be created using:</p>

<pre><code>cat /proc/sys/fs/inotify/max_user_instances
</code></pre>

<p>and then increase this limit using:</p>

<pre><code>echo VALUE &gt;&gt; /proc/sys/fs/inotify/max_user_instances
</code></pre>

<p>where VALUE is greater than the present setting. Confirm that remote_syslog starts
up and then apply this new value permanently by adding the following to
<code>/etc/sysctl.conf:</code>:</p>

<pre><code>fs.inotify.max_user_instances = VALUE
</code></pre>

<h2>
<a name="reporting-bugs" class="anchor" href="#reporting-bugs"><span class="octicon octicon-link"></span></a>Reporting bugs</h2>

<ol>
<li>See whether the issue has already been reported: <a href="https://github.com/papertrail/remote_syslog2/issues/">https://github.com/papertrail/remote_syslog2/issues/</a>
</li>
<li>If you don't find one, create an issue with a repro case.</li>
</ol><h2>
<a name="development" class="anchor" href="#development"><span class="octicon octicon-link"></span></a>Development</h2>

<p>remote_syslog2 is written in go, and uses <a href="https://github.com/kr/godep">godep</a> to manage
dependencies. To get everything set up, <a href="http://golang.org/doc/install">install go</a> then
run:</p>

<pre><code>go get github.com/kr/godep
go get github.com/mitchellh/gox
go get github.com/papertrail/remote_syslog2
</code></pre>

<p>To run tests:</p>

<pre><code># run all tests
godep go test ./...
# run all tests except the slower syslog reconnection tests
godep go test -short ./...
</code></pre>

<h2>
<a name="building" class="anchor" href="#building"><span class="octicon octicon-link"></span></a>Building</h2>

<pre><code>make
</code></pre>

<h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>Once you've made your great commits:</p>

<ol>
<li>
<a href="http://help.github.com/forking/">Fork</a> remote_syslog</li>
<li>Create a topic branch - <code>git checkout -b my_branch</code>
</li>
<li>Commit the changes without changing the Rakefile or other files unrelated to your enhancement.</li>
<li>Push to your branch - <code>git push origin my_branch</code>
</li>
<li>Create a Pull Request or an <a href="https://github.com/papertrail/remote_syslog/issues/">Issue</a> with a link to your branch</li>
<li>That's it!</li>
</ol>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">remote_syslog2 maintained by <a href="https://github.com/papertrail">papertrail</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
